---
title: "获取任务详情"
description: "查询异步任务的状态和结果"
api: "GET /v1/jobs/recordInfo"
---

## 概述

使用此端点查询通过 API 创建的任何异步任务的状态和结果。这是一个统一的查询接口，适用于所有异步模型（图像生成、视频生成等）。

## 请求参数

<ParamField query="taskId" type="string" required>
  任务 ID，创建任务时返回的唯一标识符
</ParamField>

## 请求示例

<CodeGroup>

```bash cURL
curl -X GET "https://your-api-domain.com/v1/jobs/recordInfo?taskId=task_z-image_1765174270120" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

```python Python
import requests

response = requests.get(
    "https://your-api-domain.com/v1/jobs/recordInfo",
    params={"taskId": "task_z-image_1765174270120"},
    headers={"Authorization": "Bearer YOUR_API_KEY"}
)

result = response.json()
print(result)
```

```javascript JavaScript
const taskId = "task_z-image_1765174270120";
const response = await fetch(
  `https://your-api-domain.com/v1/jobs/recordInfo?taskId=${taskId}`,
  {
    headers: {
      Authorization: "Bearer YOUR_API_KEY",
    },
  }
);

const result = await response.json();
console.log(result);
```

</CodeGroup>

## 响应示例

### 任务进行中

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "taskId": "task_z-image_1765174270120",
    "state": "generating",
    "progress": 50
  }
}
```

### 任务成功

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "taskId": "task_z-image_1765174270120",
    "state": "success",
    "resultJson": "{\"resultUrls\":[\"https://cdn.example.com/generated/image1.png\"]}"
  }
}
```

### 任务失败

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "taskId": "task_z-image_1765174270120",
    "state": "fail",
    "failCode": 501,
    "failMsg": "生成失败：内容不符合安全规范"
  }
}
```

## 任务状态说明

| 状态         | 描述               | 操作建议                              |
| ------------ | ------------------ | ------------------------------------- |
| `waiting`    | 任务已排队等待处理 | 继续轮询                              |
| `queuing`    | 任务在处理队列中   | 继续轮询                              |
| `generating` | 任务正在处理中     | 继续轮询                              |
| `success`    | 任务成功完成       | 解析 `resultJson` 获取结果            |
| `fail`       | 任务失败           | 查看 `failCode` 和 `failMsg` 了解详情 |

## 响应字段

<ResponseField name="code" type="integer">
  响应状态码，200 表示请求成功
</ResponseField>

<ResponseField name="msg" type="string">
  响应消息
</ResponseField>

<ResponseField name="data" type="object">
  <Expandable title="properties">
    <ResponseField name="taskId" type="string">
      任务唯一标识符
    </ResponseField>
    <ResponseField name="state" type="string">
      任务状态：waiting / queuing / generating / success / fail
    </ResponseField>
    <ResponseField name="progress" type="integer">
      任务进度百分比（0-100），仅在处理中时返回
    </ResponseField>
    <ResponseField name="resultJson" type="string">
      任务结果 JSON 字符串，成功时返回，需要解析后使用
    </ResponseField>
    <ResponseField name="failCode" type="integer">
      失败错误码，失败时返回
    </ResponseField>
    <ResponseField name="failMsg" type="string">
      失败错误信息，失败时返回
    </ResponseField>
  </Expandable>
</ResponseField>

## 错误码说明

| 错误码 | 描述                        | 解决方案                      |
| ------ | --------------------------- | ----------------------------- |
| 401    | 未授权 - API 密钥无效或缺失 | 检查您的 API 密钥             |
| 404    | 未找到任务                  | 验证 taskId 是否正确          |
| 422    | 原始请求中的验证错误        | 查看 failMsg 了解详情         |
| 500    | 内部服务器错误              | 几分钟后重试                  |
| 501    | 生成失败                    | 查看 failMsg 了解具体错误详情 |

## 轮询最佳实践

<Tip>
  **推荐轮询策略**： - 初始间隔：2-3 秒 - 最大间隔：10 秒 - 最大尝试次数：60
  次（约 5 分钟） - 使用指数退避策略减少请求频率
</Tip>

## 完整轮询示例

<CodeGroup>

```python Python
import requests
import time
import json

def poll_task_status(task_id, max_attempts=60, interval=3):
    """轮询任务状态直到完成或失败"""

    for attempt in range(max_attempts):
        response = requests.get(
            "https://your-api-domain.com/v1/jobs/recordInfo",
            params={"taskId": task_id},
            headers={"Authorization": "Bearer YOUR_API_KEY"}
        )

        result = response.json()
        data = result.get("data", {})
        state = data.get("state")

        print(f"尝试 {attempt + 1}: 状态 = {state}")

        if state == "success":
            result_json = json.loads(data.get("resultJson", "{}"))
            print("✅ 任务完成!")
            print("结果:", result_json.get("resultUrls"))
            return result_json

        if state == "fail":
            fail_msg = data.get("failMsg", "未知错误")
            print(f"❌ 任务失败: {fail_msg}")
            raise Exception(fail_msg)

        # 仍在处理中，等待下次轮询
        time.sleep(interval)

    raise Exception("任务在最大尝试次数后超时")

# 使用示例
try:
    results = poll_task_status("task_z-image_1765174270120")
    print("生成的内容 URL:", results.get("resultUrls"))
except Exception as e:
    print(f"错误: {e}")
```

```javascript JavaScript
async function pollTaskStatus(taskId, maxAttempts = 60, interval = 3000) {
  for (let attempt = 0; attempt < maxAttempts; attempt++) {
    const response = await fetch(
      `https://your-api-domain.com/v1/jobs/recordInfo?taskId=${taskId}`,
      {
        headers: { Authorization: "Bearer YOUR_API_KEY" },
      }
    );

    const result = await response.json();
    const { state, resultJson, failMsg } = result.data;

    console.log(`尝试 ${attempt + 1}: 状态 = ${state}`);

    if (state === "success") {
      const results = JSON.parse(resultJson);
      console.log("✅ 任务完成!");
      console.log("结果:", results.resultUrls);
      return results;
    }

    if (state === "fail") {
      console.error("❌ 任务失败:", failMsg);
      throw new Error(failMsg);
    }

    // 仍在处理中，等待下次轮询
    await new Promise((resolve) => setTimeout(resolve, interval));
  }

  throw new Error("任务在最大尝试次数后超时");
}

// 使用示例
try {
  const results = await pollTaskStatus("task_z-image_1765174270120");
  console.log("生成的内容 URL:", results.resultUrls);
} catch (error) {
  console.error("错误:", error.message);
}
```

</CodeGroup>

<Warning>
  **生产环境建议**：在生产环境中，建议使用回调通知（callBackUrl）而非轮询，以减少
  API 请求次数并获得更及时的结果通知。
</Warning>
